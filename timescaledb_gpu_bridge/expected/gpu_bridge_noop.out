-- Test: gpu_bridge no-op fallback when PG-Strom is not loaded
--
-- Verifies that the module loads cleanly, GUC parameters are accessible,
-- and the status function reports PG-Strom as not detected.
CREATE EXTENSION timescaledb_gpu_bridge;
-- Check the status function reports correctly
SELECT enabled, pgstrom_detected, timescaledb_detected
FROM gpu_bridge_status();
 enabled | pgstrom_detected | timescaledb_detected
---------+------------------+----------------------
 f       | f                | f
(1 row)

-- Verify GUC parameters are accessible and have defaults
SHOW timescaledb.gpu_transfer_cost_per_byte;
 timescaledb.gpu_transfer_cost_per_byte
----------------------------------------
 0
(1 row)

SHOW timescaledb.gpu_launch_overhead;
 timescaledb.gpu_launch_overhead
---------------------------------
 0
(1 row)

SHOW timescaledb.gpu_min_batch_rows;
 timescaledb.gpu_min_batch_rows
--------------------------------
 0
(1 row)

-- Verify we can set GUC parameters
SET timescaledb.gpu_min_batch_rows = 5000;
SHOW timescaledb.gpu_min_batch_rows;
 timescaledb.gpu_min_batch_rows
--------------------------------
 5000
(1 row)

-- Reset
RESET timescaledb.gpu_min_batch_rows;
DROP EXTENSION timescaledb_gpu_bridge;
